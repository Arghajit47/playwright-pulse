
# Playwright Pulse Reporter & Dashboard

This project provides both a custom Playwright reporter and a Next.js web dashboard to visualize your Playwright test results, now with support for **Playwright sharding**.

## How it Works

1.  **Reporter (`playwright-pulse-reporter.ts`):**
    *   A custom reporter that collects detailed results during your Playwright test run.
    *   **Sharding Support:** If tests are sharded, each shard process writes its results to a temporary file (`.pulse-shard-results-*.json`). The main reporter process then merges these files upon completion.
2.  **JSON Output:** On completion (`onEnd`), the reporter writes all collected (and potentially merged) data into a single `playwright-pulse-report.json` file in your project's specified output directory (defaults to the project root).
3.  **Next.js Dashboard (This App):** A web application built with Next.js that reads the final `playwright-pulse-report.json` file and presents the test results in a user-friendly dashboard interface.

## Setup

### 1. Install the Reporter Package

In your main Playwright project (the one containing your tests), install this reporter package:

```bash
npm install playwright-pulse-reporter --save-dev
# or
yarn add playwright-pulse-reporter --dev
# or
pnpm add playwright-pulse-reporter --save-dev
```

### 2. Configure Playwright

In your `playwright.config.ts` (or `.js`) file, add the custom reporter to the `reporter` array:

```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';
import * as path from 'path';

// Optional: Define where the final report JSON should go
const PULSE_REPORT_DIR = path.resolve(__dirname, 'pulse-report-output'); // Example: a directory in your project root

export default defineConfig({
  // ... other configurations like projects, testDir, etc.

  // Define the output directory for Playwright's own artifacts (traces, screenshots)
  // This is separate from the Pulse reporter's output directory.
  outputDir: './test-results/',

  reporter: [
    ['list'], // Keep other reporters like 'list' or 'html' if desired

    // Add the Playwright Pulse Reporter
    ['playwright-pulse-reporter', {
        // Optional: Specify the output file name (defaults to 'playwright-pulse-report.json')
        // outputFile: 'my-custom-report-name.json',

        // Optional: Specify the directory for the final JSON report
        // It's recommended to use an absolute path or one relative to the config file.
        // Defaults to process.cwd() if not specified.
        outputDir: PULSE_REPORT_DIR
    }]
  ],

  // Enable sharding if needed
  // fullyParallel: true, // Often used with sharding
  // workers: process.env.CI ? 4 : undefined, // Example worker count

  // ... other configurations
});
```

**Explanation:**

*   `outputDir` in the main `defineConfig`: This is where Playwright stores its own artifacts like traces and screenshots.
*   `outputDir` inside the `playwright-pulse-reporter` options: This specifically tells *our reporter* where to save the final `playwright-pulse-report.json`. Using a dedicated directory like `pulse-report-output` is recommended.

### 3. Run Your Tests

Execute your Playwright tests as usual. This command works whether you use sharding or not:

```bash
npx playwright test
# or specific configurations like:
# npx playwright test --project=chromium --shard=1/3
```

The `playwright-pulse-reporter` will automatically handle sharding if Playwright is configured to use it. Upon completion, the final `playwright-pulse-report.json` will be generated in the directory you specified (e.g., `pulse-report-output`).

### 4. View the Dashboard

This dashboard application needs to read the `playwright-pulse-report.json` file generated in the previous step.

**Steps:**

1.  **Navigate to this Dashboard Project:**
    ```bash
    cd path/to/playwright-pulse-reporter # The directory containing THIS dashboard code
    ```
2.  **Install Dependencies:**
    ```bash
    npm install
    # or yarn install or pnpm install
    ```
3.  **Copy the Report File:** Copy the `playwright-pulse-report.json` file generated by your tests (e.g., from your main project's `pulse-report-output` directory) into the **root directory** of *this dashboard project*.
    ```bash
    # Example: Copying from your main project to the dashboard project directory
    cp ../my-playwright-project/pulse-report-output/playwright-pulse-report.json ./
    ```
4.  **Start the Dashboard:**
    ```bash
    npm run dev
    # or yarn dev or pnpm dev
    ```

This will start the Next.js dashboard (usually on `http://localhost:9002`). It will read the `playwright-pulse-report.json` file you placed in its root.

**Alternatively, build and start for production:**

```bash
# Ensure the report JSON is in the root first
npm run build
npm run start
```

## Development (Contributing to this Project)

To work on the reporter or the dashboard itself:

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd playwright-pulse-reporter
    ```
2.  **Install dependencies:**
    ```bash
    npm install
    ```
3.  **Build the reporter:** (Needed if you make changes to the reporter code)
    ```bash
    npm run build:reporter
    ```
4.  **Run the dashboard in development mode:**
    ```bash
    # Make sure a sample playwright-pulse-report.json exists in the root
    npm run dev
    ```

## Key Files

*   `src/reporter/playwright-pulse-reporter.ts`: The core Playwright reporter logic (handles sharding).
*   `src/lib/data-reader.ts`: Server-side logic for reading the JSON report file.
*   `src/lib/data.ts`: Data fetching functions used by the Next.js dashboard components.
*   `src/app/`: Contains the Next.js dashboard pages and components.
*   `playwright-pulse-report.json`: (Generated by the reporter in your specified output directory) The data source for the dashboard, needs to be copied to the dashboard's root.
